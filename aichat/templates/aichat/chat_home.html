<!DOCTYPE html>
<html data-theme="light" lang="zh">
<head>
    <title>AI聊天首页 - Engineai</title>
    {% load static %}
    <script>
      const theme = localStorage.getItem('theme') || 'light';
      if (theme) document.documentElement.setAttribute('data-theme', theme);
    </script>
    <link href="{% static 'css/output.css' %}" rel="stylesheet" />
</head>
<body class="min-h-screen bg-base-200">
    <nav class="navbar bg-base-100 shadow-lg">
      <div class="navbar-start">
        <a class="btn btn-ghost text-xl">AI Chat</a>
      </div>
      <div class="navbar-center">
        <span class="font-bold">会话列表</span>
      </div>
      <div class="navbar-end gap-2">
        <a href="/admin/" class="btn btn-outline">管理</a>
        <a href="{% url 'aichat:create_session' %}" class="btn btn-primary">+ 新会话</a>
      </div>
    </nav>
    <main class="p-8 max-w-4xl mx-auto">
      {% if user.is_authenticated %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {% for session in sessions %}
            <div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow">
              <div class="card-body">
                <h2 class="card-title">{{ session.title|default:"无标题" }}</h2>
                <p class="text-sm opacity-75 line-clamp-2">
                  {{ session.messages.last.content|default:"暂无消息"|truncatechars:100 }}
                </p>
                <div class="card-actions justify-end">
                  <a href="{% url 'aichat:session_detail' session.id %}" class="btn btn-primary btn-sm">打开聊天</a>
                </div>
              </div>
            </div>
          {% empty %}
            <div class="col-span-full text-center py-12">
              <h3 class="text-xl font-semibold mb-4">暂无会话</h3>
              <a href="{% url 'aichat:create_session' %}" class="btn btn-primary">创建第一个会话</a>
            </div>
          {% endfor %}
        </div>
        <div class="stats shadow mt-12">
          <div class="stat">
            <div class="stat-title">可用模型</div>
            <div class="stat-value">{{ models.count }}</div>
            <div class="stat-desc">请在管理后台添加模型</div>
          </div>
        </div>
      {% else %}
        <div class="hero min-h-96">
          <div class="hero-content text-center">
            <div class="max-w-md">
              <h1 class="text-5xl font-bold">欢迎使用AI聊天</h1>
              <p class="py-6">登录管理后台添加LLM模型，然后开始聊天。</p>
              <a href="/admin/login/?next={% url 'aichat:chat_home' %}" class="btn btn-primary">去登录</a>
            </div>
          </div>
        </div>
      {% endif %}
    </main>
    <script>
      // 主题切换
      const themeSelect = document.createElement('select');
      themeSelect.className = 'select select-bordered';
      themeSelect.innerHTML = `
        <option disabled selected>主题</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
        <option value="cupcake">Cupcake</option>
      `;
      themeSelect.onchange = (e) => {
        const t = e.target.value;
        localStorage.setItem('theme', t);
        document.documentElement.setAttribute('data-theme', t);
      };
      // add to navbar end if want
    </script>
</body>
</html>
